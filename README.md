# Проектная работа по организации Data Lake #7
Соцсеть, для которой построили Data Lake, развивается — пробный запуск в Австралии оказался удачным. Команда готовится к разработке обновлений. Значит, структуру хранилища предстоит переделать, а данные — дополнить. Этим и займёмся в проекте.

## Описание задачи
Коллеги из другого проекта по просьбе нашей команды начали вычислять координаты событий (сообщений, подписок, реакций, регистраций), которые совершили пользователи соцсети. Значения координат будут появляться в таблице событий. Пока определяется геопозиция только исходящих сообщений, но уже сейчас можно начать разрабатывать новый функционал. 

В продукт планируют внедрить систему рекомендации друзей. Приложение будет предлагать пользователю написать человеку, если пользователь и адресат:
* состоят в одном канале,
* раньше никогда не переписывались,
* находятся не дальше 1 км друг от друга.

При этом команда хочет лучше изучить аудиторию соцсети, чтобы в будущем запустить монетизацию. Для этого было решено провести геоаналитику:
* Выяснить, где находится большинство пользователей по количеству сообщений, лайков и подписок из одной точки.
* Посмотреть, в какой точке Австралии регистрируется больше всего новых пользователей.
* Определить, как часто пользователи путешествуют и какие города выбирают.

Благодаря такой аналитике в соцсеть можно будет вставить рекламу: приложение сможет учитывать местонахождение пользователя и предлагать тому подходящие услуги компаний-партнёров. 




## Структура репозитория

Файл с координатами городов Австралии, которые аналитики собрали в одну таблицу — geo.csv
Изначально файл расположен по адресу <https://code.s3.yandex.net/data-analyst/data_engeneer/geo.csv>

Он был загружен локально, а потом скопирован в HDFS: 
```
!hdfs dfs -copyFromLocal /lessons/geo.csv /user/tolique7/geo.csv
```

Внутри `src` расположены две папки:
```
/src/dags```

```
/src/sql```


## Витрины данных
### Витрина пользователей - users_mart.py

Расположение: /user/tolique7/data/analytics/mart/users/

* **user_id** - идентификатор пользователя
* **act_city** - актуальный адрес. Это город, из которого было отправлено последнее сообщение
* **home_city** - домашний адрес. Это последний город, в котором пользователь был дольше 27 дней
* **travel_count** — количество посещённых городов. Если пользователь побывал в каком-то городе повторно, то это считается за отдельное посещение.
* **travel_array** — список городов в порядке посещения.
* **local_time** — местное время. Время последнего события пользователя, о котором у нас есть данные с учётом таймзоны геопозициии этого события.

### Витрина зон - geo_mart.py

Расположение: /user/tolique7/data/analytics/mart/geo/

* **month** — месяц расчёта
* **week** — неделя расчёта
* **zone_id** — идентификатор зоны (города)
* **week_message** — количество сообщений за неделю
* **week_reaction** — количество реакций за неделю
* **week_subscription** — количество подписок за неделю
* **week_user** — количество регистраций за неделю
* **month_message** — количество сообщений за месяц
* **month_reaction** — количество реакций за месяц
* **month_subscription** — количество подписок за месяц
* **month_user** — количество регистраций за месяц

### Витрина рекомендаций друзей - recommendations_mart.py

Расположение: /user/tolique7/data/analytics/mart/recommedations/

* **user_left** — первый пользователь;
* **user_right** — второй пользователь;
* **processed_dttm** — дата расчёта витрины;
* **zone_id** — идентификатор зоны (города);
* **local_time** — локальное время.

## Используемые технологии и инструменты
DataLake, Python, PySpark, HDFS, Airflow, Hadoop, Jupyter Notebook